(transaction
  (epoch
    (writes
      (define
        (fragment :f1
          ;; Basic CSV relation with paths
          (csv_data
            (csv_locator
              (paths "s3://bucket/data/file1.csv" "s3://bucket/data/file2.csv"))
            (csv_config {})
            (columns
              (column "user_id" :user_id [INT])
              (column "name" :user_name [STRING])
              (column "score" :user_score [FLOAT]))
            (asof "2025-01-01T00:00:00Z"))

          ;; CSV with custom config
          (csv_data
            (csv_locator
              (paths "https://example.com/data.csv"))
            (csv_config {
              :csv_header_row 2
              :csv_delimiter "|"
              :csv_skip 1
              :csv_quotechar "'"
              :csv_escapechar "\\"
              :csv_comment "#"
              :csv_missing_strings "NA"
              :csv_decimal_separator ","
              :csv_encoding "latin-1"
              :csv_compression "gzip" })
            (columns
              (column "timestamp" :ts [DATETIME])
              (column "value" :val [(DECIMAL 18 4)]))
            (asof "2025-01-15T12:00:00Z"))

          ;; CSV with inline data
          (csv_data
            (csv_locator
              (inline_data "user_id,name,score\n1,Alice,95.5\n2,Bob,87.3"))
            (csv_config {})
            (columns
              (column "user_id" :inline_user_id [INT])
              (column "name" :inline_user_name [STRING])
              (column "score" :inline_user_score [FLOAT]))
            (asof "2025-01-01T00:00:00Z"))

          ;; CSV with multiple types per column
          (csv_data
            (csv_locator
              (paths "/local/path/data.csv"))
            (csv_config { :csv_delimiter "\t" })
            (columns
              (column "id" :multi_id [INT STRING])
              (column "data" :multi_data [STRING FLOAT BOOLEAN]))
            (asof "2025-02-01T00:00:00Z"))

          ;; CSV with empty types (schema inferred)
          (csv_data
            (csv_locator
              (paths "data/infer.csv"))
            (csv_config {})
            (columns
              (column "col1" :inferred1 [])
              (column "col2" :inferred2 []))
            (asof "2025-03-01T00:00:00Z")))))

    (reads
      (output :user_id :user_id)
      (output :user_name :user_name)
      (output :user_score :user_score)
      (output :ts :ts)
      (output :val :val)
      (output :inline_user_id :inline_user_id)
      (output :inline_user_name :inline_user_name)
      (output :inline_user_score :inline_user_score)
      (output :multi_id :multi_id)
      (output :multi_data :multi_data)
      (output :inferred1 :inferred1)
      (output :inferred2 :inferred2))))
