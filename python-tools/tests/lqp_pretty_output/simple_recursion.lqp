(transaction
  (epoch
    (writes
      (define
        (fragment :f1
          (def :edge1
            ([x::STRING y::STRING]
              (and
                (primitive :rel_primitive_eq x "a"::STRING)
                (primitive :rel_primitive_eq y "b"::STRING))))
          (def :edge2
            ([x::STRING y::STRING]
              (and
                (primitive :rel_primitive_eq x "b"::STRING)
                (primitive :rel_primitive_eq y "c"::STRING))))
          (def :edge3
            ([x::STRING y::STRING]
              (and
                (primitive :rel_primitive_eq x "b"::STRING)
                (primitive :rel_primitive_eq y "d"::STRING))))
          (def :edge4
            ([x::STRING y::STRING]
              (and
                (primitive :rel_primitive_eq x "d"::STRING)
                (primitive :rel_primitive_eq y "e"::STRING))))
          (def :edge
            ([x::STRING y::STRING]
              (or
                (atom :edge1 x y)
                (atom :edge2 x y)
                (atom :edge3 x y)
                (atom :edge4 x y))))
          (def :path1
            ([x::STRING y::STRING]
              (atom :edge x y)))
          (def :path2
            ([x::STRING z::STRING]
              (exists [y::STRING]
                (and
                  (atom :edge x y)
                  (atom :path y z)))))
          (def :path
            ([x::STRING y::STRING]
              (or
                (atom :path1 x y)
                (atom :path2 x y))))
          (def :output
            ([x::STRING y::STRING]
              (atom :path x y))))))
    (reads
      (output :result :output))))
